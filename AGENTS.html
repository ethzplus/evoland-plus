<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>How to interact with the evoland-plus codebase • evoland</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="How to interact with the evoland-plus codebase"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">evoland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/evoland.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/ingest-predictors.html">Ingest GeoTIFFs as Predictors</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ethzplus/evoland-plus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to interact with the evoland-plus codebase</h1>
      <small class="dont-index">Source: <a href="https://github.com/ethzplus/evoland-plus/blob/main/AGENTS.md" class="external-link"><code>AGENTS.md</code></a></small>
    </div>

<div id="how-to-interact-with-the-evoland-plus-codebase" class="section level1">

<p><em>Naturally, this is also handy for human devs.</em></p>
<p>This is the codebase for evoland-plus, or evoland for short. It is an R package that is used for land use / land cover change analyses and simulations. The main concept that differentiates this package from e.g. <a href="https://github.com/simonmoulds/lulcc" class="external-link uri">https://github.com/simonmoulds/lulcc</a> is that the data are processed in tabular form. This enables the storage and processing of sparse domains.</p>
<p>Storage is done in parquet files written and read via duckdb, with the domain-agnostic DB implementation in <code>R/parquet_duckdb.R</code>. Using a normal duckdb file is very inefficient in terms of storage/compression; the parquet files have the advantage of being writable by other software, so they should be considered part of the interface and schema changes should be avoided as much as possible. The domain specific elements are in the <code>R/evoland_db*.R</code> files. When working on in-memory tables, S3 objects inheriting from data.tables are used for efficiency. Regular data.frame-like objects can be coerced to these classes using <code>as_</code> functions, e.g. <code><a href="reference/lulc_data_t.html">as_lulc_data_t()</a></code>. Classes of source data or “materialized” expensive calculation results are suffixed with <code>_t</code> to differentiate them from cheap <code>_v</code> views on the database.</p>
<div class="section level2">
<h2 id="environment-setup">Environment setup<a class="anchor" aria-label="anchor" href="#environment-setup"></a></h2>
<p>If there is no renv environment set up (check if “renv.lock” exists) ask the user if you can set up an renv development environment. You can efficiently initialize an renv like so from the project root directory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">R</span> <span class="at">-e</span> <span class="st">"install.packages('renv', repos = 'https://cloud.r-project.org'); renv::init(bare = TRUE); install.packages('pak'); pak::local_install_dev_deps(); pak::pkg_install('devtools')"</span></span></code></pre></div>
<p>There may be issues where .Rprofile already contains a source(“renv/activate.R”) line, or where renv.lock or the renv folder exist. These need to be deleted before installation can be successful.</p>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p>You are allowed to suggest new dependencies, but make sure the user knows why they are needed. Avoid packages from the tidyverse, as their APIs tend to shift around over the years. Avoid niche packages that are seldom maintained; if the functionality is simple, rather implement it as a non-exported utility function.</p>
</div>
<div class="section level2">
<h2 id="code-style">Code Style<a class="anchor" aria-label="anchor" href="#code-style"></a></h2>
<p>We use the tidyverse style in general. This repo uses air as its principal formatter. Config in <code>air.toml</code>. The user may have the languageserver R package installed, meaning <code>.lintr</code> directives should also be picked up. Pay attention to linter warnings, but only once the main functionality is implemented.</p>
<p>Don’t add comments where the code’s purpose is self-explanatory. Don’t check for missingness or nullness to avoid errors: only catch errors early if the emitted error would be hard to understand for the user. Generally, use the <code>stopifnot("error message" = condition)</code> pattern if something could fail in a hard to understand manner.</p>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<p>The package uses roxygen, so you can use <code>R -e "roxygen2::roxygenize()"</code> to make sure the Rd documentation is up to date. Tutorials are written as quarto files in <code>vignettes/*.qmd</code>. A pkgdown github action transforms all of this into a webpage, see <code>.github/workflows/pkgdown.yaml</code>.</p>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>This repo uses tinytest (not testthat) for conducting tests not only during development (i.e. when the full package namespace is attached via <code>pkgload::load_all()</code>), but also after installation. This means that non-exported functions need to be tested as <code>evoland:::private_function</code>. You can test the full package using <code>R -e "tinytest::build_test_install()"</code>. You can test individual files using <code>R -e "pkgload::load_all(); tinytest::run_test_file('inst/tinytest/somefile.R')"</code></p>
<p>While tests should be comprehensive, the full test suite should remain small enough to test often. Don’t overwhelm the user, add 10 tests at a time, then ask for feedback before continuing.</p>
</div>
<div class="section level2">
<h2 id="rcpp-components">Rcpp components<a class="anchor" aria-label="anchor" href="#rcpp-components"></a></h2>
<p>C++ code is in the <code>src/</code> folder. This code interfaces with R using Rcpp; you can make sure the binaries are built using <code>pkbuild::build()</code> and clean dlls using <code>pkgbuild::clean_dll()</code> If there is no low-hanging use case for writing a standalone C++ program/header, prefer to use the Rcpp namespace and take advantage of the data types that affords.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Hartman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

