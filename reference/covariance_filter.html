<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Two stage covariate filtering — covariance_filter • evoland</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two stage covariate filtering — covariance_filter"><meta name="description" content="The covariance_filter returns a set of covariates for land use land cover change
(LULCC) models based on a two-stage variable selection: a first statistical fit
estimates a covariate's quality for a given prediction task. A second step selects
all variables below a given correlation threshold: We iterate over a correlation
matrix ordered in the first step. Starting within the leftmost column, all rows (i.e.
candidates) greater than the given threshold are dropped from the full set of
candidates. This candidate selection is retained and used to select the next column,
until no further columns are left to investigate. The columns that were iterated over
are those returned as a character vector of selected variable names."><meta property="og:description" content="The covariance_filter returns a set of covariates for land use land cover change
(LULCC) models based on a two-stage variable selection: a first statistical fit
estimates a covariate's quality for a given prediction task. A second step selects
all variables below a given correlation threshold: We iterate over a correlation
matrix ordered in the first step. Starting within the leftmost column, all rows (i.e.
candidates) greater than the given threshold are dropped from the full set of
candidates. This candidate selection is retained and used to select the next column,
until no further columns are left to investigate. The columns that were iterated over
are those returned as a character vector of selected variable names."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">evoland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/evoland.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ingest-predictors.html">Ingest GeoTIFFs as Predictors</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ethzplus/evoland-plus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two stage covariate filtering</h1>
      <small class="dont-index">Source: <a href="https://github.com/ethzplus/evoland-plus/blob/main/R/covariance_filter.R" class="external-link"><code>R/covariance_filter.R</code></a></small>
      <div class="d-none name"><code>covariance_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>covariance_filter</code> returns a set of covariates for land use land cover change
(LULCC) models based on a two-stage variable selection: a first statistical fit
estimates a covariate's quality for a given prediction task. A second step selects
all variables below a given correlation threshold: We iterate over a correlation
matrix ordered in the first step. Starting within the leftmost column, all rows (i.e.
candidates) greater than the given threshold are dropped from the full set of
candidates. This candidate selection is retained and used to select the next column,
until no further columns are left to investigate. The columns that were iterated over
are those returned as a character vector of selected variable names.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">covariance_filter</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  result_col <span class="op">=</span> <span class="st">"result"</span>,</span>
<span>  rank_fun <span class="op">=</span> <span class="va">rank_poly_glm</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu">compute_balanced_weights</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">result_col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  corcut <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rank_poly_glm</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">compute_balanced_weights</span><span class="op">(</span><span class="va">trans_result</span>, legacy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">select_by_correlation</span><span class="op">(</span><span class="va">cor_mat</span>, <span class="va">corcut</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.table of target variable and candidate covariates to be filtered;
wide format with one predictor per column.</p></dd>


<dt id="arg-result-col">result_col<a class="anchor" aria-label="anchor" href="#arg-result-col"></a></dt>
<dd><p>Name of the column representing the transition results (0: no
trans, 1: trans)</p></dd>


<dt id="arg-rank-fun">rank_fun<a class="anchor" aria-label="anchor" href="#arg-rank-fun"></a></dt>
<dd><p>Optional function to compute ranking scores for each covariate.
Should take arguments (x, y, weights, ...) and return a single numeric value
(lower = better). Defaults to polynomial GLM p-value ranking.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Optional weights vector</p></dd>


<dt id="arg-corcut">corcut<a class="anchor" aria-label="anchor" href="#arg-corcut"></a></dt>
<dd><p>Correlation cutoff threshold</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to rank_fun.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A numeric vector representing a single covariate</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A binary outcome vector (0/1)</p></dd>


<dt id="arg-trans-result">trans_result<a class="anchor" aria-label="anchor" href="#arg-trans-result"></a></dt>
<dd><p>Binary outcome vector (0/1)</p></dd>


<dt id="arg-legacy">legacy<a class="anchor" aria-label="anchor" href="#arg-legacy"></a></dt>
<dd><p>Bool, use legacy weighting?</p></dd>


<dt id="arg-cor-mat">cor_mat<a class="anchor" aria-label="anchor" href="#arg-cor-mat"></a></dt>
<dd><p>Absolute correlation matrix</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A set of column names (covariates) to retain</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function first ranks covariates using the provided ranking function (default:
quasibinomial polynomial GLM). Then, it iteratively removes highly (Pearson)
correlated variables based on the correlation cutoff threshold, preserving variables
in order of their ranking. See
<a href="https://github.com/ethzplus/evoland-plus-legacy/blob/main/R/lulcc.covfilter.r" class="external-link">https://github.com/ethzplus/evoland-plus-legacy/blob/main/R/lulcc.covfilter.r</a> for
where the concept came from. The original author was Antoine Adde, with edits by
Benjamin Black. A similar mechanism is found in <a href="https://github.com/antadde/covsel/" class="external-link">https://github.com/antadde/covsel/</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>rank_poly_glm()</code>: Default ranking function using polynomial GLM. Returns
the lower p value for each of the polynomial terms</p></li>
<li><p><code>compute_balanced_weights()</code>: Compute class-balanced weights for imbalanced binary
outcomes; returns a numeric vector</p></li>
<li><p><code>select_by_correlation()</code>: Implements the iterative selection procedure.</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Hartman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

