% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parquet_db.R
\name{parquet_db}
\alias{parquet_db}
\title{R6 Base Class for Parquet-Backed DuckDB Storage}
\description{
A domain-agnostic R6 class that provides an interface to a folder-based data
storage system using DuckDB for in-memory SQL operations and parquet files
for efficient on-disk persistence. This class can be inherited by
domain-specific database classes.
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{connection}}{DBI connection object to an in-memory DuckDB database}

\item{\code{path}}{Character string path to the data folder}

\item{\code{writeopts}}{Write options for DuckDB parquet output}

\item{\code{partitioning}}{Named list of character vectors defining partition columns for tables}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-parquet_db-new}{\code{parquet_db$new()}}
\item \href{#method-parquet_db-set_partitioning}{\code{parquet_db$set_partitioning()}}
\item \href{#method-parquet_db-execute}{\code{parquet_db$execute()}}
\item \href{#method-parquet_db-get_query}{\code{parquet_db$get_query()}}
\item \href{#method-parquet_db-attach_table}{\code{parquet_db$attach_table()}}
\item \href{#method-parquet_db-detach_table}{\code{parquet_db$detach_table()}}
\item \href{#method-parquet_db-row_count}{\code{parquet_db$row_count()}}
\item \href{#method-parquet_db-list_tables}{\code{parquet_db$list_tables()}}
\item \href{#method-parquet_db-with_tables}{\code{parquet_db$with_tables()}}
\item \href{#method-parquet_db-fetch}{\code{parquet_db$fetch()}}
\item \href{#method-parquet_db-get_table_metadata}{\code{parquet_db$get_table_metadata()}}
\item \href{#method-parquet_db-delete_from}{\code{parquet_db$delete_from()}}
\item \href{#method-parquet_db-commit}{\code{parquet_db$commit()}}
\item \href{#method-parquet_db-print}{\code{parquet_db$print()}}
\item \href{#method-parquet_db-clone}{\code{parquet_db$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-new"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new parquet_db object
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$new(path, extensions = character(0))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{Character string. Path to the data folder.}

\item{\code{extensions}}{Character vector of DuckDB extensions to load (e.g., "spatial")}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A new \code{parquet_db} object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-set_partitioning"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-set_partitioning}{}}}
\subsection{Method \code{set_partitioning()}}{
Set partitioning scheme for a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$set_partitioning(table_name, cols)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string}

\item{\code{cols}}{Character vector of column names to partition by}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-execute"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-execute}{}}}
\subsection{Method \code{execute()}}{
Execute a SQL statement
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$execute(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Number of rows affected by statement
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-get_query"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-get_query}{}}}
\subsection{Method \code{get_query()}}{
Execute a SQL query and return results
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$get_query(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL query statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.table with query results
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-attach_table"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-attach_table}{}}}
\subsection{Method \code{attach_table()}}{
Attach a table from parquet file as a temporary table in DuckDB
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$attach_table(table_name, columns = "*", where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character. Name of table to attach.}

\item{\code{columns}}{Character vector. Optional SQL column selection, defaults to "*"}

\item{\code{where}}{Character. Optional SQL WHERE clause to subset the table.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-detach_table"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-detach_table}{}}}
\subsection{Method \code{detach_table()}}{
Detach a table from the in-memory database
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$detach_table(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character. Name of table to drop.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-row_count"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-row_count}{}}}
\subsection{Method \code{row_count()}}{
Get row count for a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$row_count(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Integer number of rows
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-list_tables"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-list_tables}{}}}
\subsection{Method \code{list_tables()}}{
List all tables (files) in storage
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$list_tables()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character vector of table names
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-with_tables"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-with_tables}{}}}
\subsection{Method \code{with_tables()}}{
Execute a function with specified tables attached, handling attach/detach automatically.
If a table is already attached in the DuckDB instance, it won't be re-attached or detached.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$with_tables(tables, func, ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tables}}{Character vector of table names to attach}

\item{\code{func}}{Function to execute with tables attached}

\item{\code{...}}{Additional arguments passed to func}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Result of func
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-fetch"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-fetch}{}}}
\subsection{Method \code{fetch()}}{
Fetch data from a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$fetch(table_name, where = NULL, limit = NULL, map_cols = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}

\item{\code{where}}{Character string. Optional WHERE clause for the SQL query.}

\item{\code{limit}}{Integer. Optional limit on number of rows to return.}

\item{\code{map_cols}}{Vector of columns to be converted from key/value structs to R lists}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.table
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-get_table_metadata"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-get_table_metadata}{}}}
\subsection{Method \code{get_table_metadata()}}{
Get table metadata
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$get_table_metadata(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Named list
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-delete_from"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-delete_from}{}}}
\subsection{Method \code{delete_from()}}{
Delete rows from a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$delete_from(table_name, where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to delete from.}

\item{\code{where}}{Character string. Optional WHERE clause; if NULL, deletes all rows.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Number of rows deleted
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-commit"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-commit}{}}}
\subsection{Method \code{commit()}}{
Commit data using overwrite, append, or upsert modes. Handles autoincrement, key
identity columns, and list-to-MAP conversion.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$commit(
  x,
  table_name,
  key_cols,
  autoincrement_cols = character(0),
  map_cols = character(0),
  partition_cols = character(0),
  method = c("overwrite", "append", "upsert")
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Data frame to commit. If character, in-duckdb-memory table.}

\item{\code{table_name}}{Character string table name}

\item{\code{key_cols}}{Character vector of columns that define uniqueness. If missing,
use all columns starting with \code{id_}}

\item{\code{autoincrement_cols}}{Character vector of column names to auto-increment}

\item{\code{map_cols}}{Character vector of columns to convert to MAP format}

\item{\code{partition_cols}}{Character vector of columns to use for partitioning}

\item{\code{method}}{Character, one of "overwrite", "append", "upsert" (upsert being an
update for existing rows, and insert for new rows)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-print"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-print}{}}}
\subsection{Method \code{print()}}{
Print method for parquet_db
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$print(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{Not used}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
self (invisibly)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param autoincrement_cols Character vector of column names to auto-increment
return Invisible NULL (called for side effects)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param autoincrement_cols Character vector of column names to auto-increment
return Invisible NULL (called for side effects)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param key_cols Character vector of columns that define uniqueness. If missing,
use all columns starting with \code{id_}
param autoincrement_cols Character vector of column names to auto-increment
return Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_db-clone"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_db-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_db$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
