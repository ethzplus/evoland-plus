% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/evoland_db.R
\name{evoland_db}
\alias{evoland_db}
\title{R6 Class for Folder-Based Data Storage Interface}
\description{
An R6 class that provides an interface to a folder-based data storage system
for the evoland package. Each table is stored as a parquet (or CSV) file.
This class uses DuckDB for in-memory SQL operations while persisting data
to disk in parquet format for better compression.
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{connection}}{DBI connection object to an in-memory DuckDB database}

\item{\code{path}}{Character string path to the data folder}

\item{\code{default_format}}{Default file format for new tables}

\item{\code{writeopts}}{Default write options for DuckDB, see}
}
\if{html}{\out{</div>}}
}
\section{Active bindings}{
\if{html}{\out{<div class="r6-active-bindings">}}
\describe{
\item{\code{coords_t}}{A \code{coords_t} instance; see \code{\link[=create_coords_t]{create_coords_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{periods_t}}{A \code{periods_t} instance; see \code{\link[=create_periods_t]{create_periods_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{lulc_meta_t}}{A \code{lulc_meta_t} instance; see \code{\link[=create_lulc_meta_t]{create_lulc_meta_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{lulc_meta_long_v}}{Return a \code{lulc_meta_long_v} instance, i.e. unrolled \code{lulc_meta_t}.}

\item{\code{lulc_data_t}}{A \code{lulc_data_t} instance; see \code{\link[=as_lulc_data_t]{as_lulc_data_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{transitions_v}}{Get the transitions from \code{lulc_data_t}.}

\item{\code{pred_data_t_float}}{A \code{pred_data_t_float} instance; see
\code{\link[=create_pred_data_t]{create_pred_data_t()}} for the type of object to assign. Assigning is an
upsert operation.}

\item{\code{pred_data_t_int}}{A \code{pred_data_t_int} instance; see
\code{\link[=create_pred_data_t]{create_pred_data_t()}} for the type of object to assign. Assigning is an
upsert operation.}

\item{\code{pred_data_t_bool}}{A \code{pred_data_t_bool} instance; see
\code{\link[=create_pred_data_t]{create_pred_data_t()}} for the type of object to assign. Assigning is an
upsert operation.}

\item{\code{extent}}{Return a terra SpatExtent based on coords_t}

\item{\code{coords_minimal}}{data.table with only (id_coord, lon, lat)}

\item{\code{pred_meta_t}}{A \code{pred_meta_t} instance; see \code{\link[=create_pred_meta_t]{create_pred_meta_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{pred_sources_v}}{Retrieve a table of distinct predictor urls and their
md5sum}

\item{\code{trans_meta_t}}{A \code{trans_meta_t} instance; see \code{\link[=create_trans_meta_t]{create_trans_meta_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{trans_preds_t}}{A \code{trans_preds_t} instance; see \code{\link[=create_trans_preds_t]{create_trans_preds_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{intrv_meta_t}}{A \code{intrv_meta_t} instance; see \code{\link[=create_intrv_meta_t]{create_intrv_meta_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{intrv_masks_t}}{A \code{intrv_masks_t} instance; see \code{\link[=as_intrv_masks_t]{as_intrv_masks_t()}} for the type of
object to assign. Assigning is an upsert operation.}

\item{\code{trans_models_t}}{A \code{trans_models_t} instance; see \code{\link[=create_trans_models_t]{create_trans_models_t()}} for the type
of object to assign. Assigning is an upsert operation.}

\item{\code{alloc_params_t}}{A \code{alloc_params_t} instance; see \code{\link[=as_alloc_params_t]{as_alloc_params_t()}} for the type
of object to assign. Assigning is an upsert operation.}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-evoland_db-new}{\code{evoland_db$new()}}
\item \href{#method-evoland_db-commit_overwrite}{\code{evoland_db$commit_overwrite()}}
\item \href{#method-evoland_db-commit_append}{\code{evoland_db$commit_append()}}
\item \href{#method-evoland_db-commit_upsert}{\code{evoland_db$commit_upsert()}}
\item \href{#method-evoland_db-fetch}{\code{evoland_db$fetch()}}
\item \href{#method-evoland_db-list_tables}{\code{evoland_db$list_tables()}}
\item \href{#method-evoland_db-execute}{\code{evoland_db$execute()}}
\item \href{#method-evoland_db-get_query}{\code{evoland_db$get_query()}}
\item \href{#method-evoland_db-attach_table}{\code{evoland_db$attach_table()}}
\item \href{#method-evoland_db-detach_table}{\code{evoland_db$detach_table()}}
\item \href{#method-evoland_db-row_count}{\code{evoland_db$row_count()}}
\item \href{#method-evoland_db-delete_from}{\code{evoland_db$delete_from()}}
\item \href{#method-evoland_db-set_report}{\code{evoland_db$set_report()}}
\item \href{#method-evoland_db-set_coords}{\code{evoland_db$set_coords()}}
\item \href{#method-evoland_db-set_periods}{\code{evoland_db$set_periods()}}
\item \href{#method-evoland_db-add_predictor}{\code{evoland_db$add_predictor()}}
\item \href{#method-evoland_db-print}{\code{evoland_db$print()}}
\item \href{#method-evoland_db-clone}{\code{evoland_db$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-new"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new evoland_db object
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$new(path, default_format = c("parquet", "csv"), ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{Character string. Path to the data folder.}

\item{\code{default_format}}{Character. Default file format ("parquet" or "csv").
Default is "parquet".}

\item{\code{...}}{passed on to \code{set_report}}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A new \code{evoland_db} object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-commit_overwrite"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-commit_overwrite}{}}}
\subsection{Method \code{commit_overwrite()}}{
Commit data in overwrite mode
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$commit_overwrite(
  x,
  table_name,
  autoincrement_cols = character(0),
  map_cols = character(0)
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Data frame to commit}

\item{\code{table_name}}{Character string table name}

\item{\code{autoincrement_cols}}{Character vector of column names to auto-increment}

\item{\code{map_cols}}{Character vector of columns to convert to MAP format}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-commit_append"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-commit_append}{}}}
\subsection{Method \code{commit_append()}}{
Commit data in append mode
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$commit_append(
  x,
  table_name,
  autoincrement_cols = character(0),
  map_cols = character(0)
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Data frame to commit}

\item{\code{table_name}}{Character string table name}

\item{\code{autoincrement_cols}}{Character vector of column names to auto-increment}

\item{\code{map_cols}}{Character vector of columns to convert to MAP format}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-commit_upsert"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-commit_upsert}{}}}
\subsection{Method \code{commit_upsert()}}{
Commit data in upsert mode
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$commit_upsert(
  x,
  table_name,
  key_cols = grep("^id_", names(x), value = TRUE),
  autoincrement_cols = character(0),
  map_cols = character(0)
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Data frame to commit}

\item{\code{table_name}}{Character string table name}

\item{\code{key_cols}}{Identify unique columns - heuristic: if prefixed with
id_, the set of all columns designates a uniqueness condition}

\item{\code{autoincrement_cols}}{Character vector of column names to auto-increment}

\item{\code{map_cols}}{Character vector of columns to convert to MAP format}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-fetch"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-fetch}{}}}
\subsection{Method \code{fetch()}}{
Fetch data from storage
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$fetch(table_name, where = NULL, limit = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}

\item{\code{where}}{Character string. Optional WHERE clause for the SQL query.}

\item{\code{limit}}{integerish, limit the amount of rows to return}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.table
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-list_tables"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-list_tables}{}}}
\subsection{Method \code{list_tables()}}{
List all tables (files) in storage
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$list_tables()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character vector of table names
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-execute"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-execute}{}}}
\subsection{Method \code{execute()}}{
Execute statement
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$execute(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
No. of rows affected by statement
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-get_query"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-get_query}{}}}
\subsection{Method \code{get_query()}}{
Get Query
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$get_query(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
No. of rows affected by statement
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-attach_table"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-attach_table}{}}}
\subsection{Method \code{attach_table()}}{
Attach a single table as a temporary table in DuckDB memory. This is
useful for working with multiple tables in SQL queries instead of loading
them into R objects.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$attach_table(table_name, columns = "*", where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character vector. Names of table to attach.}

\item{\code{columns}}{Character vector. Optional sql column selection, defaults to "*"}

\item{\code{where}}{A SQL where statement to optionally subset the table being attached.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-detach_table"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-detach_table}{}}}
\subsection{Method \code{detach_table()}}{
Detach one or more tables from the database.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$detach_table(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character. Name of table to drop.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-row_count"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-row_count}{}}}
\subsection{Method \code{row_count()}}{
Get table row count
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$row_count(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
No. of rows
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-delete_from"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-delete_from}{}}}
\subsection{Method \code{delete_from()}}{
Delete rows from a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$delete_from(table_name, where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to delete from.}

\item{\code{where}}{Character string, defaults to NULL: delete everything in table.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
No. of rows affected
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-set_report"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-set_report}{}}}
\subsection{Method \code{set_report()}}{
Set reporting metadata
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$set_report(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{each named argument is entered into the table with the argument name
as its key}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-set_coords"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-set_coords}{}}}
\subsection{Method \code{set_coords()}}{
Set coordinates for DB. Cannot overwrite existing table (would mean cascading deletion)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$set_coords(type = c("square"), ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{type}}{string; which type of coordinates to set, see \link{coords_t}}

\item{\code{...}}{named arguments are passed to the appropriate coordinate creator function}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-set_periods"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-set_periods}{}}}
\subsection{Method \code{set_periods()}}{
Set periods for DB. See \code{\link{periods_t}}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$set_periods(
  period_length_str = "P10Y",
  start_observed = "1985-01-01",
  end_observed = "2020-01-01",
  end_extrapolated = "2060-01-01"
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{period_length_str}}{ISO 8601 duration string specifying the length of each
period (currently only accepting years, e.g., "P5Y" for 5 years)}

\item{\code{start_observed}}{Start date of the observed data (YYYY-MM-DD)}

\item{\code{end_observed}}{End date of the observed data (YYYY-MM-DD)}

\item{\code{end_extrapolated}}{End date for extrapolation time range (YYYY-MM-DD)}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-add_predictor"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-add_predictor}{}}}
\subsection{Method \code{add_predictor()}}{
Add a predictor to the database
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$add_predictor(pred_spec, pred_data, pred_type)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{pred_spec}}{List of predictor specification; see \code{\link[=create_pred_meta_t]{create_pred_meta_t()}}}

\item{\code{pred_data}}{An object that can be coerced to \code{\link{pred_data_t}}, but doesn't have an
\code{id_pred}}

\item{\code{pred_type}}{Passed to \code{\link[=as_pred_data_t]{as_pred_data_t()}}; one of float, int, bool}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-print"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-print}{}}}
\subsection{Method \code{print()}}{
Print method for evoland_db
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$print(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{Not used}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
self (invisibly)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-evoland_db-clone"></a>}}
\if{latex}{\out{\hypertarget{method-evoland_db-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{evoland_db$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
