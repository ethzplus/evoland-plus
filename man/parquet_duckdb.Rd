% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parquet_duckdb.R
\name{parquet_duckdb}
\alias{parquet_duckdb}
\title{R6 Base Class for Parquet-Backed DuckDB Storage}
\description{
A domain-agnostic R6 class that provides an interface to a folder-based data
storage system using DuckDB for in-memory SQL operations and parquet files
for efficient on-disk persistence. This class can be inherited by
domain-specific database classes.
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{connection}}{DBI connection object to an in-memory DuckDB database}

\item{\code{path}}{Character string path to the data folder}

\item{\code{default_format}}{Default file format for new tables}

\item{\code{writeopts}}{Default write options for DuckDB}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-parquet_duckdb-new}{\code{parquet_duckdb$new()}}
\item \href{#method-parquet_duckdb-execute}{\code{parquet_duckdb$execute()}}
\item \href{#method-parquet_duckdb-get_query}{\code{parquet_duckdb$get_query()}}
\item \href{#method-parquet_duckdb-attach_table}{\code{parquet_duckdb$attach_table()}}
\item \href{#method-parquet_duckdb-detach_table}{\code{parquet_duckdb$detach_table()}}
\item \href{#method-parquet_duckdb-row_count}{\code{parquet_duckdb$row_count()}}
\item \href{#method-parquet_duckdb-list_tables}{\code{parquet_duckdb$list_tables()}}
\item \href{#method-parquet_duckdb-with_tables}{\code{parquet_duckdb$with_tables()}}
\item \href{#method-parquet_duckdb-fetch}{\code{parquet_duckdb$fetch()}}
\item \href{#method-parquet_duckdb-delete_from}{\code{parquet_duckdb$delete_from()}}
\item \href{#method-parquet_duckdb-commit}{\code{parquet_duckdb$commit()}}
\item \href{#method-parquet_duckdb-print}{\code{parquet_duckdb$print()}}
\item \href{#method-parquet_duckdb-clone}{\code{parquet_duckdb$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-new"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new parquet_duckdb object
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$new(
  path,
  default_format = c("parquet", "json"),
  extensions = character(0)
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{path}}{Character string. Path to the data folder.}

\item{\code{default_format}}{Character. Default file format ("parquet" or "json").
Default is "parquet".}

\item{\code{extensions}}{Character vector of DuckDB extensions to load (e.g., "spatial")}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A new \code{parquet_duckdb} object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-execute"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-execute}{}}}
\subsection{Method \code{execute()}}{
Execute a SQL statement
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$execute(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Number of rows affected by statement
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-get_query"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-get_query}{}}}
\subsection{Method \code{get_query()}}{
Execute a SQL query and return results
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$get_query(statement)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{statement}}{A SQL query statement}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.table with query results
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-attach_table"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-attach_table}{}}}
\subsection{Method \code{attach_table()}}{
Attach a table from parquet/CSV file as a temporary table in DuckDB
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$attach_table(table_name, columns = "*", where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character. Name of table to attach.}

\item{\code{columns}}{Character vector. Optional SQL column selection, defaults to "*"}

\item{\code{where}}{Character. Optional SQL WHERE clause to subset the table.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-detach_table"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-detach_table}{}}}
\subsection{Method \code{detach_table()}}{
Detach a table from the in-memory database
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$detach_table(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character. Name of table to drop.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-row_count"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-row_count}{}}}
\subsection{Method \code{row_count()}}{
Get row count for a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$row_count(table_name)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Integer number of rows
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-list_tables"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-list_tables}{}}}
\subsection{Method \code{list_tables()}}{
List all tables (files) in storage
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$list_tables()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Character vector of table names
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-with_tables"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-with_tables}{}}}
\subsection{Method \code{with_tables()}}{
Execute a function with specified tables attached, handling attach/detach automatically.
If a table is already attached in the DuckDB instance, it won't be re-attached or detached.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$with_tables(tables, func, ...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{tables}}{Character vector of table names to attach}

\item{\code{func}}{Function to execute with tables attached}

\item{\code{...}}{Additional arguments passed to func}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Result of func
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-fetch"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-fetch}{}}}
\subsection{Method \code{fetch()}}{
Fetch data from a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$fetch(
  table_name,
  where = NULL,
  limit = NULL,
  map_cols = NULL,
  json_colspec = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to query.}

\item{\code{where}}{Character string. Optional WHERE clause for the SQL query.}

\item{\code{limit}}{Integer. Optional limit on number of rows to return.}

\item{\code{map_cols}}{Vector of columns to be converted from key/value structs to R lists}

\item{\code{json_colspec}}{For JSON files, an optional column type specification}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A data.table
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-delete_from"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-delete_from}{}}}
\subsection{Method \code{delete_from()}}{
Delete rows from a table
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$delete_from(table_name, where = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{table_name}}{Character string. Name of the table to delete from.}

\item{\code{where}}{Character string. Optional WHERE clause; if NULL, deletes all rows.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Number of rows deleted
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-commit"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-commit}{}}}
\subsection{Method \code{commit()}}{
Commit data using overwrite, append, or upsert modes. Handles autoincrement, key
identity columns, and list-to-MAP conversion.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$commit(
  x,
  table_name,
  key_cols,
  autoincrement_cols = character(0),
  map_cols = character(0),
  method = c("overwrite", "append", "upsert"),
  format = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Data frame to commit. If character, in-duckdb-memory table.}

\item{\code{table_name}}{Character string table name}

\item{\code{key_cols}}{Character vector of columns that define uniqueness. If missing,
use all columns starting with \code{id_}}

\item{\code{autoincrement_cols}}{Character vector of column names to auto-increment}

\item{\code{map_cols}}{Character vector of columns to convert to MAP format}

\item{\code{method}}{Character, one of "overwrite", "append", "upsert" (upsert being an
update for existing rows, and insert for new rows)}

\item{\code{format}}{Character. Optional format override ("parquet" or "json"). If NULL,
uses the existing file's format or default_format for new files.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-print"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-print}{}}}
\subsection{Method \code{print()}}{
Print method for parquet_duckdb
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$print(...)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{...}}{Not used}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
self (invisibly)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param autoincrement_cols Character vector of column names to auto-increment
param map_cols Character vector of columns to convert to MAP format
return Invisible NULL (called for side effects)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param autoincrement_cols Character vector of column names to auto-increment
param map_cols Character vector of columns to convert to MAP format
return Invisible NULL (called for side effects)
param x Data frame to commit. If character, in-duckdb-memory table.
param table_name Character string table name
param key_cols Character vector of columns that define uniqueness. If missing,
use all columns starting with \code{id_}
param autoincrement_cols Character vector of column names to auto-increment
param map_cols Character vector of columns to convert to MAP format
return Invisible NULL (called for side effects)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-parquet_duckdb-clone"></a>}}
\if{latex}{\out{\hypertarget{method-parquet_duckdb-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{parquet_duckdb$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
